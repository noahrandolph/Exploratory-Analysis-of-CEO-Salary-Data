---
title: "Lab 1: Exploratory Analysis of CEO Salary Data"
author: "Anamika Sinha, Asha Anju, Noah Randolph"
date: "June 3, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

An exploratory analysis of CEO and company data was conducted to explore CEO salary, with a particular interest in answering the question of whether company performance is related to CEO salary.

Exploratory data analysis techniques were used and will be presented with commentary on the findings. We first explore data in univariate fashion, followed by multivariate analyses selected for their contribution to the exploration of CEO salary. In general, CEO salary is treated as a response variable, while other datasets are treated as predictor variables.

# Setup

We will utilize the "car: Companion to Applied Regression" package in R and load it, as well as the data file of interest, here.
```{r load}
library(car)
load("ceo_w203.RData")
```

# Exploratory Analysis

To get an initial understanding of the dataset, we'll look at the structure of its data frame and a summary of its variables.
```{r}
str(CEO)
summary(CEO)
```

Now we have an idea of the size of our dataset (184 observations) and the scale of each variable. The data appears to be all integers. We can see that college and grad appear to be variables of just 0 and 1 outcomes, so it will be useful to convert those to factors for labeling. Both profits and market value (mktval) have negative values.

Given that we are most interested in company performance and CEO salary, market value and profits appear to be our primary variables of interest, along with salary of course. The rest of which are secondary variables that could contribute to a better understanding of the primary relatiionships.

Given the large number of variables, scatterplot matrices are printed below to provide an overview of relationships between variables and identify areas of interest.

```{r}
scatterplotMatrix(~ CEO$salary + CEO$profits + CEO$mktval + CEO$age + CEO$ceoten,
                  data = CEO, diagonal = "histogram")
```

In the upper diagonal half of the above matrix, it appears that the two company performance variables, profits and market value, both show a positive trend against CEO salary, although the data for both appear to be highly clustered at the low end. The secondary CEO age variable does not appear to have a strong influence on profits and market value, but there do appear to be slighter more high values to the right of the median age. The secondary variable CEO tenure (ceoten) looks to have higher values of profits and market value clustered at the low end of tenure. 

```{r}
scatterplotMatrix(~ CEO$salary + CEO$profits + CEO$mktval + CEO$comten, data = CEO,
                  diagonal = "histogram")
```

In the upper diagonal half of the matrix above, the secondary variable company tenure (comten) appears to have slight positive relationships between profits and market value. Salary appears to be fairly evenly distributed across the span of company tenures.

## Univariate Analyses

We investigate the variables independently to understand their frequency distributions and to observe any anomalies, apparent data errors, and missing values. The dataset describing college attendance will not be analyzed due to the small number of CEOs who did not attend college (<4%), as can be seen below. 
```{r}
CEO$college <- factor(CEO$college, labels = c("Did Not Attend College",
                                              "Attended College"))
summary(CEO$college)
```


### Univariate Analysis of Salary Data

We start with the analysis of CEO Salary Data, our response variable of interest. We first examine the histogram of salary information.The individual salary amounts have been scaled to reflect the value in millions. We have set the break points manually but the bin width is same as that obtained using Freedman and Diaconis rule.

```{r}
hist(CEO$salary/1000, breaks = seq(0,6,.2),
     xaxt = "n",
     main = "Histogram of CEO Salary",
     xlab = "CEO Salary (million dollars)")
axis(1, seq(0,6,1))
```

Next we look at the summary statistics for the salary data.
```{r}
summary(CEO$salary/1000)
```

The following observations are apparent from our analysis of CEO salaries:

1. The distribution of CEO salaries is positively skewed with a peak around \$0.6 million and a maximum value of $5.299 million.
2. Except the maximum value, all salaries are below \$3.0 million. Most of the salaries are below $2.0 million. 
3. The distance of maximum value from the 3rd quartile value is more than the interquartile range, thus making the data point an outlier. 

Further analysis of the data corresponding to this outlier salary is required. Eventhough the maximum salary is an outlier, there is no strong evidence to conclude that it should be removed from our analysis.

### Univariate Analysis of Market Value

Market value is commonly associated with company performance, which is of primary interest as it relates to CEO salary. Thus, we include an assessessment of its data in the variable, "mktval", univariately. First, a summary of the data: 

```{r summary}
summary(CEO$mktval)
```

The market value range is vast, with the maximum value far greater than the values in the interquartile range. In fact, the mean is greater than not just the median, but also the 3rd quartile. Since a stock price cannot go below $0, and market value for public companies is composed of the sum of the values of each individual stock, any negative values should be scrutinized.

```{r subset market value}
CEO[CEO$mktval < 0, ]
```

A subset of the data less than zero reveals that a coding error is apparent. The -1 values in both market value and profits likely represent data points that were unavailable for particular companies. Further analyses in this report will be on subsets of the data excluding the values of -1 for market value and profits.

```{r}
cleanCEO <- subset(CEO, CEO$mktval > 0)
```

Next, we create a histogram of the cleaned up market value data. The dataset is transformed by a factor of 1/1,000 to make for easier reading of the X-axis. The bins are set with even widths at a number of 20, which is an amount between two common rules, one of which is the square root of the number of data points, and the other is the Freedman and Diaconis rule.
 
```{r market value histogram}
mktvalbillions <- cleanCEO$mktval/1000
hist(mktvalbillions, breaks = seq(0, 50, 2.5), 
     main = "Histogram of Market Value",
     xlab = "Market Value, end of 1990 (billion dollars)")
```

The histogram reveals the following characteristics:

1. Market value is skewed toward the positive and frequencies drop steeply between \$250 million and $500 million, for a decaying profile of frequencies as market value increases.

2. Although market value does not take on negative values, integer effects are not of concern due to its high dispersion.

3. Most of the market values fall below $500 million.

4. There is a large gap between highly dispersed data between roughly \$2.75 billion and $4.25 billion.

Although the market values between \$4 billion and $5 billion falls far outside of the bulk of the data, there is no strong evidence to conclude that they should be removed from the analysis as outliers.

### Univariate Analysis of Company profits

Next, we investigate company profits as it is also an indicator of comany performance.

```{r}
summary(CEO$profits)
```


```{r}
hist(CEO$profits,
     breaks = 20,
     ylim = c(0,175),
#    labels = T,
     main = "Histogram of Company Profit",
     xlab = "Profit in 1990 (million dollars)")
```

 
 Observations of company profit: 

1. Most companies have profits below $250 million. 

2. The histogram has a slight positive skew due to the presence of some outliers.They seem to be pushing the mean to even beyond the 3rd quartile.
The mean is much higher than the median value.

3. 15 companies with negative profits is worth investigating. Since most of the profits is from zero to 250 million that bin is worth investigating.

4. It will be interesting to see the salaries of CEOs with negative profit for the 12 companies in 0 and -200 million range. We can ignore the 5 values with profits of -1 
for that analysis, as the univariate market value analysis above suggests a coding error.


### Univariate Analysis of CEO Age

We next examine the age of CEO's to understand the distribution and its features.

```{r}
summary(CEO$age)
```

```{r}
hist(CEO$age, breaks = "FD",
     main = "Histogram of CEO Age",
     xlab = "Age of CEO (years)")
```

The following observations are apparent from our analysis of age information:

1. The ages cover a large range with a minimum age of 21 years and maximum age of 86 years.
2. The distribution peaks peak around 55-60 years of age and have a slight negative skew. 
3. 50% of the CEO's in the dataset have ages in a 10 year range between 51 and 61.25 years.

### Univariate Analysis of CEO Tenure

We next examine years of CEO tenure, which may relate to CEO salary as any normal salary typically grows with tenure. We manually set the cut points for our histogram to make 13 bins, which is roughly the square root of the number of data points.

```{r}
hist(CEO$ceoten, breaks = seq(0, 39, by=3), 
     main = "Histogram of Years as CEO", 
     xlab = "Years as CEO with Current Company", 
     xaxt = "n")
axis(1, seq(0, 39, by=3))
```

The following observations are apparent in the histogram of CEO tenures:

1. The lower bound is at zero years (indeed, negative years would not make sense in this context).

2. The data is skewed positively, with more than one data point in the rightmost bin of 36 to 39 years.

3. CEO tenure frequencies peak in the lowest number of years and then mostly drop in a decaying form as the number of years increases.

4. There is a gap in tenures from 30 to 33 years and a decrease from 15 to 18 years, but these are most likely due to dispersion of lower frequencies of higher year values.



### Univariate analysis of Company tenure

We analyzed the total number of years CEOs stayed with the 
company including years before or after becoming CEO.

```{r}
summary(CEO$comten)
```

```{r}
hist(CEO$comten, 
#     labels = T,
     ylim = c(0,40),
     main = "Histogram of Years in Company",
     xlab = "Years"
     )
```

Observations: 

1.We see that there is almost a uniform spread of data
across the number of years from zero to forty years. 

2.There is a bit of spike at 30-35 years and 1 outlier in the 55 to 60 years. 

3.Overall, company tenure does not seem to have an impact on the output.


### Univariate analysis of grad (CEOs with graduate degrees)

Since grad is a categorical variable, we create a factor variable
and assign levels of GRAD and "Non_Grad" to it.

```{r}
CEO$grad <- factor(CEO$grad,
                      levels = c("0", "1"),
                      labels = c("Non-Grad", "Grad"))
```

```{r}
plot(CEO$grad,
     main = "Count of grad versus non-grad CEOs")
```

```{r}
summary(CEO$grad)
```

Observations:

1. We see that the number of CEOs without a graduate degree is 
pretty comparable to the number of CEOs with graduate degree.

2. This means that the data is pretty well distributed and graduate degree
should not be having a huge impact on the outcome. 


## Multivariate Analyses

Now that we understand the type and general nature of the data in each variable, we turn to multivariate analyses to begin to answer the question of whether CEO salary is related to company performace.

### Multivariate Analysis of Market Value Versus CEO Salary

Market value is plotted against CEO salary as it is one measure of company performance. We are interested in seeing the degree to which the level of CEO salary is related to the market value of that CEO's company.

Because of the high clustering of market value data seen in the scatterplot matrix of the initial exploration above, market value will be plotted using a $log_{10}$ scale. We exclude observations (whole rows of data) including the -1 values found in the univariate analysis of market values (though they would not plot on a log scale even if included).

```{r}
plot(log10(cleanCEO$mktval), cleanCEO$salary, main = "Market Value Versus CEO Salary", 
     xlab = expression(paste(Log[10], 
                             " of Market Value, end of 1990 (million dollars)")), 
     ylab = "Salary (million dollars)")
abline(lm(cleanCEO$salary ~ log10(cleanCEO$mktval)))
```

The plot above, with its linear regression line, shows a clear positive relationship between the two variables. The correlation, below, also shows that indeed some relation exists. However, the relationship cannot be said to be linear, since market value was plotted in $log_{10}$ scale. 
```{r}
cor(cleanCEO$mktval, cleanCEO$salary)
```

### Relationship between market value and salary when data is grouped by market value.

We group the data into different bins using market values and analyse the salary statistics for these bins.

```{r}
mktval_bins <- cut(cleanCEO$mktval/1000,
                        c(0,1,2,5,10,20,60))
summary(mktval_bins)
```

```{r}
salary_mean_by_mktval = by(cleanCEO$salary/1000, mktval_bins, mean)
salary_median_by_mktval = by(cleanCEO$salary/1000, mktval_bins, median)

plot(sort(unique(mktval_bins)),salary_mean_by_mktval,
     main = "Plot of mean salary by market value",
     ylab = "Mean Salary in $ millions",
     xlab = "Marketvalue in $ billions")

plot(sort(unique(mktval_bins)),salary_median_by_mktval,
     main = "Plot of median salary by market value",
     ylab = "Median Salary in $ millions",
     xlab = "Marketvalue in $ billions")
```
These plots further strengthen our assessment of the positive relationship between salary and market values (proxy for company performance).

## Analysis of Secondary Variables

In this section, we analyse the impact of the remaining variables on our primary variables of interest viz. salary, market value and profits.

### Effects of CEO Tenure

The variable ceoten captures the number of years of service as CEO. The data is reported as integers and ranges from  0 to 37. Before analysing the influence of ceo tenure on the primary variables, we group them into bins for easier analysis.

```{r}
# Creating a new variable ceoten_bins
ceoten_bins <- cut(cleanCEO$ceoten,
                        c(0,3,6,10,20,40),
                        include.lowest = TRUE,right = FALSE, 
                        labels = c("<3 yrs","3-6 yrs", "6-10 yrs", 
                                   '10-20 yrs','20-40 yrs'))

# Gives no of datapoints in each bin
summary(ceoten_bins)
```

We calculate the mean and median salaries for each of these bins and plot them.

```{r}
salary_mean_by_ceoten = by(cleanCEO$salary/1000, ceoten_bins, mean)
salary_median_by_ceoten = by(cleanCEO$salary/1000, ceoten_bins, median)

plot(sort(unique(ceoten_bins)),salary_mean_by_ceoten,
     main = "Plot of mean salary by CEO Tenure",
     xlab = "CEO Tenure in years",
     ylab = "Salary in $ millions")

plot(sort(unique(ceoten_bins)),salary_median_by_ceoten,
     main = "Plot of median salary by CEO Tenure",
     xlab = "CEO Tenure in years",
     ylab = "Salary in $ millions")

```
The mean and median salaries for CEO's is comparitively lower if their tenure is less than 6 years.

Now we explore the relationship between market value and ceo tenure. 

```{r}
ceoten_mean_by_mktval = by(cleanCEO$ceoten, mktval_bins, mean)
ceoten_median_by_mktval = by(cleanCEO$ceoten, mktval_bins, median)

plot(sort(unique(mktval_bins)),ceoten_mean_by_mktval,
     main = "Plot of mean CEO Tenure by market value",
     ylab = "CEO Tenure in years",
     xlab = "Marketvalue in $ billions")

plot(sort(unique(mktval_bins)),ceoten_median_by_mktval,
     main = "Plot of median CEO Tenure by market value",
     ylab = "CEO Tenure in years",
     xlab = "Marketvalue in $ billions")
```

For companies with market values 5 million or less, the tenure of CEO is similar. For companies with marketvalue above 5 million, there is a large variation in mean and median CEO tenure.

### Possible Company Tenure Effects

We group the data into bins based on company tenure.
```{r}
comten_bins <- cut(cleanCEO$comten,
                   c(0,10,20,30,40,60),
                   labels = c('<10', '10-20 yrs','20-30 yrs',
                                   '30-40 yrs', '40-60 yrs'),
                   right = FALSE)
```

```{r}
# Gives no of datapoints in each bin
summary(comten_bins)
```

```{r}
salary_mean_by_comten = by(cleanCEO$salary/1000, comten_bins, mean)
salary_median_by_comten = by(cleanCEO$salary/1000, comten_bins, median)


plot(sort(unique(comten_bins)),salary_mean_by_comten,
     main = "Plot of mean salary by Company Tenure",
     xlab = "Company Tenure in years",
     ylab = "Salary in $ millions")

plot(sort(unique(comten_bins)),salary_median_by_comten,
     main = "Plot of median salary by Company Tenure",
     xlab = "Company Tenure in years",
     ylab = "Salary in $ millions")

```
Surprisingly the median salary for CEO's with company tenure more than 40 years is much less than the rest of the group.


```{r}
comten_mean_by_mktval = by(cleanCEO$comten, mktval_bins, mean)
comten_median_by_mktval = by(cleanCEO$comten, mktval_bins, median)

plot(sort(unique(mktval_bins)),comten_mean_by_mktval,
     main = "Plot of mean Company Tenure by market value",
     ylab = "Company Tenure in years",
     xlab = "Marketvalue in $ billions")

plot(sort(unique(mktval_bins)),comten_median_by_mktval,
     main = "Plot of median Company Tenure by market value",
     ylab = "Company Tenure in years",
     xlab = "Marketvalue in $ billions")
```
We see three different clusters in the plot of company tenure vs market value. For companies with market value > $10 billion, the median tenure is above 30 years. The companies with market value between 2 and 10 million have a median company tenure  around 26 years. For market value 2 million of less, the median tenure is closer to 20 years.

This change in company tenure with market value does not successfully explain the change in salary levels with market value.

## Possible Age Effects

```{r}
age_bins <- cut(cleanCEO$age, 
                     c(0,40,50,60,70,90), 
                     right = FALSE)

# Gives number of datapoints in each age range
summary(age_bins)
```
```{r}
salary_mean_by_age = by(cleanCEO$salary/1000, age_bins, mean)
salary_median_by_age = by(cleanCEO$salary/1000, age_bins, median)


plot(sort(unique(age_bins)),salary_mean_by_age,
     main = "Plot of mean salary by Age",
     xlab = "Age in years",
     ylab = "Salary in $ millions")

plot(sort(unique(age_bins)),salary_median_by_age,
     main = "Plot of median salary by Age",
     xlab = "Age in years",
     ylab = "Salary in $ millions")

```



```{r}
age_mean_by_mktval = by(cleanCEO$age, mktval_bins, mean)
age_median_by_mktval = by(cleanCEO$age, mktval_bins, median)

plot(sort(unique(mktval_bins)),age_mean_by_mktval,
     main = "Plot of mean Age by market value",
     ylab = "Age in years",
     xlab = "Marketvalue in $ billions")

plot(sort(unique(mktval_bins)),age_median_by_mktval,
     main = "Plot of median Age by market value",
     ylab = "Age in years",
     xlab = "Marketvalue in $ billions")
```
Here again we see three different behaviors. Smaller firms (market value 5 billion or less) have a median age closer to 56 years, Firms with market value in 5-20 billion range have a median age closer to 61 years and the largest firms in our dataset have the lowest median age. 

# Influence of education
```{r}
grad_bins <- as.factor(cleanCEO$grad)

summary(grad_bins)
```

```{r}
salary_mean_by_grad = by(cleanCEO$salary/1000, grad_bins, mean)
salary_median_by_grad = by(cleanCEO$salary/1000, grad_bins, median)

plot(sort(unique(grad_bins)),salary_mean_by_grad,
     main = "Plot of mean salary by education",
     xlab = "Graduated or Not",
     ylab = "Salary in $ millions")

plot(sort(unique(grad_bins)),salary_median_by_grad,
     main = "Plot of median salary by education",
     xlab = "Graduated or not",
     ylab = "Salary in $ millions")
```
Education does not have a big impact of CEO salaries. The salaries of CEO's are similar irrespective of whether they graduated or not.

```{r}
grad_count_by_mktval = by(cleanCEO$grad, mktval_bins, sum)
total_count_by_mktval = by(cleanCEO$grad, mktval_bins, length)

plot(sort(unique(mktval_bins)),(grad_count_by_mktval/total_count_by_mktval),
     main = "Plot of % of CEO's who graduated grouped by market value",
     ylab = "% of CEO's who graduated",
     xlab = "Market value in $ millions")

```
More than 60% of the firms that has a market value over 2 million has a CEO who has graduated. The percentage is lower for smaller firms. Larger firms seem to choose CEO's who have graduated college. 

## Confounding Effects

We have used profits and market values as proxy for company performance. We have explored the relationship between these individual variables and salary. However the two variables themselves exhibit a positive relationship.

```{r}
profit_mean_by_mktval = by(cleanCEO$profits, mktval_bins, mean)
profit_median_by_mktval = by(cleanCEO$profits, mktval_bins, median)

plot(sort(unique(mktval_bins)),profit_mean_by_mktval,
     main = "Plot of mean profit by market value",
     ylab = "Mean profit in $ millions",
     xlab = "Marketvalue in $ billions")

plot(sort(unique(mktval_bins)),profit_median_by_mktval,
     main = "Plot of median profit by market value",
     ylab = "Median profit in $ millions",
     xlab = "Marketvalue in $ billions")
```
Therefore a part of the positive relationship of Market value with Salary can be explained by profits.